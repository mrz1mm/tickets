-- ##################################################################
-- #  MIGRATION 6: SCHEMA PER IL SISTEMA DI INVITI
-- ##################################################################

-- ### 24. NOTIFICATION ###
CREATE TABLE invitations (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    company_id BIGINT NOT NULL,
    email VARCHAR(100) NOT NULL,
    token VARCHAR(255) NOT NULL UNIQUE,
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    is_registered BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),

    CONSTRAINT fk_invitations_to_company FOREIGN KEY(company_id) REFERENCES companies(id) ON DELETE CASCADE,
    -- Vincolo per assicurare che si possa invitare la stessa email una sola volta per azienda se l'invito Ã¨ ancora valido
    CONSTRAINT uq_invitation_email_company_id UNIQUE (email, company_id)
);

CREATE INDEX idx_invitations_token ON invitations(token);