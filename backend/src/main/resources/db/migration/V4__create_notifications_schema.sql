-- ##################################################################
-- #  MIGRATION 4: SCHEMA PER LE NOTIFICHE
-- ##################################################################

-- ### 23. NOTIFICATION ###
CREATE TABLE notifications (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    company_id BIGINT NOT NULL,
    user_profile_id BIGINT NOT NULL,
    ticket_id BIGINT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    is_read BOOLEAN NOT NULL DEFAULT FALSE,
    is_digested BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    deleted_at TIMESTAMP WITH TIME ZONE NULL,

    CONSTRAINT fk_notifications_to_user_profile FOREIGN KEY(user_profile_id) REFERENCES user_profiles(id) ON DELETE CASCADE,
    CONSTRAINT fk_notifications_to_ticket FOREIGN KEY(ticket_id) REFERENCES tickets(id) ON DELETE CASCADE
);
CREATE INDEX idx_notifications_user_profile_id ON notifications(user_profile_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);